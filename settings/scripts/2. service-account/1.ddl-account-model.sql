DROP SCHEMA IF EXISTS BANK CASCADE;
CREATE SCHEMA BANK;

SET SEARCH_PATH = "BANK";

DROP TABLE IF EXISTS BANK.MOVEMENT;
DROP TABLE IF EXISTS BANK.ACCOUNT;
DROP TABLE IF EXISTS BANK.CLIENT;
DROP TABLE IF EXISTS BANK.PERSON;

CREATE TABLE BANK.PERSON (
    ID              BIGINT 		    GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NAME            VARCHAR(100)    NOT NULL,
    GENDER          VARCHAR (6)  	NULL,
    AGE             INTEGER       	NULL,
    IDENTIFICATION  VARCHAR (50)   	NULL,
    ADDRESS         VARCHAR (50)   	NULL,
    PHONE           VARCHAR (15)    NULL,

    CONSTRAINT PERSON_PK PRIMARY KEY (ID)
) INHERITS (PUBLIC.ENTITY_BASE);

CREATE TABLE BANK.CLIENT (
    ID          BIGINT 		        GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    PASSWORD    VARCHAR(100)        NOT NULL,

    CONSTRAINT CLIENT_PK PRIMARY KEY (ID)
) INHERITS (BANK.PERSON);

CREATE TABLE BANK.ACCOUNT (
    ID              BIGINT 		    GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    ACCOUNT_NUMBER  BIGINT          NOT NULL,
    ACCOUNT_TYPE    VARCHAR (20)    NOT NULL,
    OPENING_BALANCE NUMERIC         NOT NULL,
    CURRENT_BALANCE NUMERIC         NOT NULL,
    CLIENT_ID       BIGINT          NOT NULL,

    CONSTRAINT ACCOUNT_PK           PRIMARY KEY (ID),
    CONSTRAINT ACCOUNT_CLIENT_FK    FOREIGN KEY (CLIENT_ID) REFERENCES BANK.CLIENT (ID)
) INHERITS (PUBLIC.ENTITY_BASE);


CREATE TABLE BANK.MOVEMENT (
    ID              BIGINT 		    GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    MOVEMENT_TYPE   VARCHAR (10)    NOT NULL,
    BALANCE         NUMERIC         NULL,
    VALUE           NUMERIC         NOT NULL,
    DATE            TIMESTAMP       NOT NULL,
    ID_ACCOUNT      BIGINT          NOT NULL,

    CONSTRAINT MOVEMENT_PK           PRIMARY KEY (ID),
    CONSTRAINT MOVEMENT_ACCOUNT_FK  FOREIGN KEY (ID_ACCOUNT) REFERENCES BANK.ACCOUNT (ID)
) INHERITS (PUBLIC.ENTITY_BASE);


SELECT * FROM BANK.CLIENT;
SELECT * FROM BANK.ACCOUNT;